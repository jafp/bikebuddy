"use strict";function AppCtrl(e,t,n,r,i){n.get("/api/users/session").success(function(e){t.user=e}),n.get("/api/areas").success(function(e){t.areas=e}),e.logout=function(){n.delete("/api/users/session").success(function(){t.user=null,r.path()==="/"?i.current.scope.load():r.path("/")})}}function IndexCtrl(e,t,n,r,i){e.filter={area:"",type:""},e.userCreated=i.get("user-created"),e.load=function(){r.get("/api/trips").success(function(n){var r,i,o;if(t.user)for(r=0,i=n.length;r<i;r++)o=n[r],_.contains(o.participants,t.user._id)&&(o.participating=!0);e.trips=e.filteredTrips=_.filter(n,s)})},e.load();var s=function(t){var n=e.filter;if(n.area)if(!t.area||t.area!==n.area)return!1;if(n.type)if(!t.type||t.type.toLowerCase()!==n.type.toLowerCase())return!1;return!0};e.$watch("filter",function(){e.trips&&(e.filteredTrips=_.filter(e.trips,s))},!0),e.join=function(s){e.user?r.post("/api/trips/"+s._id+"/join",{user:t.user._id}).success(function(e){e.error?alert("Du kunne ikke tilmeldes turen :-("):load()}):(n.path("/ny-profil"),i.put("reason","not-logged-in"))},e.leave=function(t){r.post("/api/trips/"+t._id+"/leave",{user:e.user._id}).success(function(e){e.error?alert("Du kunne ikke afmeldes turen :-("):load()})},e.showTrip=function(e){n.path("/tur/"+e._id)}}function TripCtrl(e,t,n,r){t.id?n.get("/api/trips/"+t.id).success(function(t){e.trip=t}).error(function(){r.path("/")}):r.path("/")}function TripFormCtrl(e,t,n,r){var i=function(){e.trip={type:"MTB",area:"nordsjaelland-og-koebenhavn",time:"08:00"}};i(),e.submit=function(){var i,s;if(e.trip._submit)return;e.trip._submit=!0,s=angular.copy(e.trip),s.when&&s.when!==""&&(s.when=moment(s.when+" "+s.time,"DD/MM/YYYY HH:mm").toDate()),t.put("/api/trips",{trip:s}).success(function(t,i){e.trip._submit=!1,t.errors?e.trip.errors=t.errors:(r.put("notice","trip-created"),n.path("/tur/"+t._id))})}}function ProfileCtrl(){}function AboutCtrl(){}function UserFormCtrl(e,t,n,r,i){e.user={},e.reason=n.get("reason"),e.submit=function(){var s=angular.copy(e.user);t.put("/api/users",s).success(function(t){t.errors?e.user.errors=t.errors:(r.user=t,n.put("user-created",!0),i.path("/"))})}}function LoginCtrl(e,t,n,r){e.user={},e.submit=function(){t.post("/api/users/session",e.user).success(function(t){t.invalidCredentials?e.user.errors=[{param:"user.email",msg:"invalid-login"},{param:"user.password",msg:""}]:(r.user=t.user,n.path("/"))})}}angular.module("bb",["bb.filters","bb.services","bb.directives"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"/partials/index.html",controller:IndexCtrl}).when("/tur/ny",{templateUrl:"/partials/trip.form.html",controller:TripFormCtrl}).when("/tur/:id",{templateUrl:"/partials/trip.html",controller:TripCtrl}).when("/profil",{templateUrl:"/partials/profile.html",controller:ProfileCtrl}).when("/logind",{templateUrl:"/partials/login.html",controller:LoginCtrl}).when("/om",{templateUrl:"/partials/about.html",controller:AboutCtrl}).when("/ny-profil",{templateUrl:"/partials/user.form.html",controller:UserFormCtrl}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]).run(["$rootScope",function(e){var t;t=$("[ng-view]"),e.$on("$routeChangeStart",function(){t.fadeOut(20)}),e.$on("$routeChangeSuccess",function(){t.fadeIn(200)})}]),"use strict";var services=angular.module("bb.services",[]).value("version","0.1").factory("User",["$http",function(e){var t="/api/users";return{create:function(n){return e.put(t,n)}}}]).factory("$flash",["$cacheFactory",function(e){var t={};return{put:function(e,n){if(typeof e=="object")for(var r in e)e.hasOwnProperty(r)&&this.put(r,e[r]);t[e]=n},get:function(e){var n=t[e];return delete t[e],n},peek:function(e){return t[e]}}}]);"use strict",angular.module("bb.filters",[]).filter("tripType",function(){return function(e){e=e||"";switch(e.toLowerCase()){case"mtb":return"MTB";case"road":return"Landevej"}return"Ukendt type"}}).filter("areaName",["$rootScope",function(e){return function(t){var n=_.find(e.areas,function(e){return e.id===t});return n.name}}]),"use strict",angular.module("bb.directives",[]).directive("datepicker",function(){var e=function(e,t,n,r){function i(){r.$setViewValue(t.val())}if(!r)return;t=$(t),t.datepicker({format:"dd/mm/yyyy"}),t.on("changeDate",function(){e.$apply(i)})};return{require:"?ngModel",link:e}}).directive("timeOptions",function(){var e=function(e,t,n){var r=e.$eval(n.timeOptions);for(var i=6;i<24;i++){var s=(i<10?"0":"")+i,o=s+":00",u=s+":30";t.append($("<option />").val(o).text(o)),t.append($("<option />").val(u).text(u))}};return{link:e}}).directive("errors",function(){var e={required:"Udfyld venligst","invalid-email":"Ugyldig e-mailadresse","email-already-in-use":"Der findes allerede en bruger med den e-mail","invalid-login":"Udgyldigt logind, pr√∏v igen","password-not-confirmed":"Password ikke gentaget rigtigt"},t=function(t,n,r){var i=r.errorsModelPrefix||"",s,o,u,a;t.$watch(r.errors,function(t){t&&(s={},_.each(t,function(t){o=s[i+t.param],o||(s[i+t.param]=o=[]),o.push(e[t.msg]||t.msg)}),$("input, select, textarea",n).not("[type=submit]").each(function(e,t){t=$(t).removeClass("error"),t.parent().find(".invalid").remove(),u=t.attr("ng-model"),o=s[u],o&&(t.addClass("error"),a=$('<span class="invalid"><img src="/static/img/error.png" /> </span>'),a.append(o.join(", ")),t.parent().append(a))}))})};return{link:t}}),"use strict",AppCtrl.$inject=["$scope","$rootScope","$http","$location","$route"],IndexCtrl.$inject=["$scope","$rootScope","$location","$http","$flash"],TripCtrl.$inject=["$scope","$routeParams","$http","$location"],TripFormCtrl.$inject=["$scope","$http","$location","$flash"],UserFormCtrl.$inject=["$scope","$http","$flash","$rootScope","$location"],LoginCtrl.$inject=["$scope","$http","$location","$rootScope"];